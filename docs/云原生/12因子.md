# 12 因子

2015 年，由 Heroku 提出，AWS Elastic BeansTalk，Cloud Foundry 等共同参与进一步对云原生的架构特征进行了系统化总结与补充，首次提出了云原生“十二因子”，微服务，以及 DevOps 等云原生的关键要素与特征：

## 因子 1：一份代码，多份部署

每个可部署 app 在版本控制系统中仅有一个独立的代码库，可以在不同的环境中部署多个实例。

## 因子 2：依赖

App 应该使用适当的工具（如 Maven、Bundler、NPM）来对依赖进行显式的声明，而不该在部署环境中隐式的实现依赖。

## 因子 3：配置

配置或其他随发布环境（如部署、类生产、生产）而变更的部分应当作为操作系统级的环境变量注入。

## 因子 4：后端服务

后端服务，例如数据库、消息代理应视为附加资源，并在所有环境中同等看待。

## 因子 5：构建，发布，运行

严格区分构建，发布，运行这三个步骤。直接修改处于运行状态的代码是非常不可取的做法，因为这些修改很难再同步回构建步骤。

## 因子 6：进程

以一个或多个无状态进程运行应用，任何需要持久化的数据存储在后端服务内，比如数据库。

## 因子 7：端口绑定

应用完全自我加载而不依赖于任何网络服务器就可以创建一个面向网络的服务。互联网应用通过端口绑定来提供服务，并监听发送至该端口的请求。

## 因子 8：并发

通过进程模型进行扩展，进程是一等公民。开发人员可以将不同的工作分配给不同的进程类型。例如，HTTP 请求交给前端 Web 进程来处理，而常驻的后台工作则交由后台任务处理进程负责。

## 因子 9：易处理

快速启动和优雅终止可最大化健壮性，进程应是易处理的也即可以瞬间开启或停止，从而有利于快速、弹性的伸缩应用，迅速部署变化的代码或配置，稳健的部署应用。进程应当追求最小启动时间，一旦接收终止信号就会优雅的终止，就网络进程而言，优雅终止是指停止监听服务的端口，即拒绝所有新的请求，并继续执行当前已接收的请求，然后退出。对于任务处理进程来说，优雅终止是指将当前任务退回队列。进程还应当在面对突然死亡时保持健壮。

## 因子 10：开发与验证环境等价

通过保持开发、类生产和生产环境尽可能的相同来实现持续交付和部署。

## 因子 11：日志

不管理日志文件，将日志视为事件流，允许执行环境通过集中式服务收集、聚合、索引和分析事件。

## 因子 12：管理进程

日常管理类任务（如数据库迁移），应该在与 app 长期运行的相同的环境中一次性完成。这些特性很适合快速部署应用程序，因为它们不需要对将要部署的环境做任何假定。对环境假设能够允许底层云平台使用简单而一致的机制，轻松实现自动化，快速配置新环境，并部署应用，优化应用的部署速度。
